# Video Generation System

Automatically creates vertical videos (1080x1920) from news segments with text overlays and background music.

## How It Works

1. **Segment Generation** (`generate_segments.py`)
   - Fetches news articles
   - Generates answers with Gemini AI
   - Finds relevant stock photos from Pexels
   - Saves to Google Sheets

2. **Image & Text Download** (`fetch_segments_for_video.py`)
   - Downloads images from Pexels URLs
   - Saves captions as text files
   - Creates numbered sequence (0001.jpg, 0001.txt, etc.)

3. **Video Rendering** (`video/make_video.py`)
   - Overlays text on images
   - Adds translucent background bar for readability
   - Stitches images into video with fade transitions
   - Adds background music

## Directory Structure

```
/assets/
  music.mp3              # Background music (add your own)
  fonts/                 # Custom fonts (optional)
  
/generated/              # Auto-generated by fetch script
  0001.jpg               # Downloaded Pexels images
  0001.txt               # Sentence captions
  0002.jpg
  0002.txt
  ...

/output/                 # Final videos
  final.mp4              # Completed video with music

/work/                   # Temporary files (auto-created)
  0001_baked.jpg         # Images with text overlays
  ...
```

## GitHub Actions Workflows

### 1. Generate Segments (`news_agent.yml`)
Runs 5x daily (or on-demand):
- Picks top political news story
- Generates commentary segments
- Finds relevant stock photos
- Saves to Google Sheets

### 2. Generate Video (`make_video.yml`)
Runs after segment generation:
- Downloads images and captions
- Renders text overlays
- Creates MP4 video
- Uploads as artifact

## Manual Usage

### Prerequisites
```bash
pip install pillow requests python-dotenv gspread google-auth
# ffmpeg must be installed system-wide
```

### 1. Fetch Latest Segments
```bash
python fetch_segments_for_video.py --output-dir generated
```

### 2. Generate Video
```bash
python video/make_video.py
```

Output: `output/final.mp4`

### 3. With Custom Run ID
```bash
python fetch_segments_for_video.py --run-id run-20251106T002810Z
python video/make_video.py
```

## Adding Background Music

1. Download royalty-free music (MP3 format)
2. Place it at `assets/music.mp3`
3. The video script will automatically include it

**Free Music Sources:**
- [YouTube Audio Library](https://www.youtube.com/audiolibrary)
- [Free Music Archive](https://freemusicarchive.org/)
- [Incompetech](https://incompetech.com/music/royalty-free/)

## Video Specifications

- **Format**: MP4 (H.264 + AAC)
- **Resolution**: 1080x1920 (9:16 portrait)
- **Frame Rate**: 30 FPS
- **Duration**: 4 seconds per slide
- **Text**: White text with drop shadow on translucent black bar
- **Transitions**: Fade in/out at start and end

## Customization

Edit `video/make_video.py` configuration:

```python
VIDEO_W, VIDEO_H = 1080, 1920     # Resolution
DURATION_PER_SLIDE = 4            # Seconds per slide
FONT_SIZE = 72                    # Text size
MARGIN = 80                       # Text padding
LINE_WIDTH = 25                   # Words per line
FADE_SEC = 0.5                    # Fade duration
```

## Troubleshooting

### "No images found in generated/"
Run `fetch_segments_for_video.py` first to download images.

### "ffmpeg not found"
Install ffmpeg:
- **macOS**: `brew install ffmpeg`
- **Ubuntu**: `sudo apt-get install ffmpeg`
- **Windows**: Download from [ffmpeg.org](https://ffmpeg.org)

### Video has no audio
Make sure `assets/music.mp3` exists. The script runs fine without music but outputs a silent video.

### Text doesn't fit / looks wrong
Adjust `FONT_SIZE`, `LINE_WIDTH`, or `MARGIN` in `make_video.py`.

### Images look stretched
The script automatically letterboxes images. Pexels provides portrait images which should fit well.

## CI/CD Pipeline

```
[News Article] 
    ↓
[generate_segments.py] → Google Sheets
    ↓
[fetch_segments_for_video.py] → generated/*.jpg + *.txt
    ↓
[video/make_video.py] → output/final.mp4
    ↓
[GitHub Actions Artifact] → Download from Actions tab
```

## Next Steps

- Upload videos to YouTube/TikTok/Instagram
- Add voiceover with text-to-speech
- Customize transitions and effects
- A/B test different music tracks
- Automate social media posting
